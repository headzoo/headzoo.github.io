---
layout: post
title: "Webpack Encore with Symfony 3 - headzoo.io"
date: 2017-06-30
featured_image: /images/featured-encore.jpeg
---

<div>
  <p>
    I decided to give <a href="http://symfony.com/doc/current/frontend.html" title="">Webpack
      Encore</a> a whirl while I was building this site, and I thought I would document my
    experience.
  </p>

  <blockquote>
    <p>
      Webpack Encore is a simpler way to integrate Webpack into your application. It wraps Webpack,
      giving you a clean & powerful API for bundling JavaScript modules, pre-processing CSS & JS and
      compiling and minifying assets. Encore gives you professional asset system that's a delight to
      use.
    </p>
  </blockquote>

  <p>
    Webpack Encore configures Webpack with sensible defaults, and it also configures Webpack using
    method calls instead of a JSON<em>ish</em> configuration script. You can use it any time you would
    normally use Webpack, and it also appears to be a replacement for Assetic in Symonfy projects.
    Which means Symfony developers should get ready to use it.
  </p>

  <p><strong>Configuration</strong></p>

  <p>
    I'm using the following configuration script which I saved in the Symfony project root directory
    as <em>webpack.config.js</em>.
  </p>

  <div class="code-block-container">
    <div class="text-right">
      <button class="btn btn-link code-block-copy-btn" data-clipboard-target="#id-4">Copy</button>
    </div>

    <pre><code id="id-4" class="language-js hljs javascript"><span class=
"hljs-keyword">var</span> Encore  = <span class="hljs-built_in">require</span>(<span class=
"hljs-string">'@symfony/webpack-encore'</span>);
<span class="hljs-keyword">var</span> webpack = <span class=
"hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);

Encore
.setOutputPath(<span class="hljs-string">'./web/build/'</span>)
.setPublicPath(<span class="hljs-string">'/build'</span>)
.cleanupOutputBeforeBuild()
.addEntry(<span class="hljs-string">'js/app'</span>, <span class=
"hljs-string">'./web/src/js/index.jsx'</span>)
.addStyleEntry(<span class="hljs-string">'css/app'</span>, <span class=
"hljs-string">'./web/src/scss/app.scss'</span>)
.enableReactPreset()
.enableSassLoader()
.enablePostCssLoader()
.autoProvidejQuery()
.enableSourceMaps(!Encore.isProduction())
.enableVersioning(Encore.isProduction())
;

<span class="hljs-keyword">let</span> config = Encore.getWebpackConfig();
<span class="hljs-built_in">module</span>.exports = config;</code></pre>
  </div>

  <p><strong>Versioning</strong>
  </p>

  <p>Webpack Encore supports versioning assets through the use of a JSON manifest file. Versioning
    renames the asset files when they change, which forces browsers to re-download them. Webpack Encore
    and the template <code>asset()</code> function handles everything for you.</p>

  <p>The following template:</p>

  <div class="code-block-container">
    <div class="text-right">
      <button class="btn btn-link code-block-copy-btn" data-clipboard-target="#id-5">Copy</button>
    </div>

    <pre><code id="id-5" class="language-twig hljs"><span class="xml"><span class=
"hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class=
"hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class=
"hljs-name">title</span>&gt;</span>headzoo.io<span class="hljs-tag">&lt;/<span class=
"hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class=
"hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class=
"hljs-attr">content</span>=<span class=
"hljs-string">"width=device-width, initial-scale=1"</span> <span class=
"hljs-attr">name</span>=<span class="hljs-string">"viewport"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class=
"hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class=
"hljs-template-variable">{{ asset('build/css/app.css') }}</span><span class="xml"><span class=
"hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">rel</span>=<span class=
"hljs-string">"stylesheet"</span> <span class="hljs-attr">media</span>=<span class=
"hljs-string">"screen"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class=
"hljs-attr">id</span>=<span class="hljs-string">"mount"</span>&gt;</span><span class=
"hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class=
"hljs-attr">src</span>=<span class="hljs-string">"</span></span></span><span class=
"hljs-template-variable">{{ asset('build/js/app.js') }}</span><span class="xml"><span class=
"hljs-tag"><span class="hljs-string">"</span>&gt;</span><span class="undefined"></span><span class=
"hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></code></pre>
  </div>

  <p>Will render as the following HTML:</p>

  <div class="code-block-container">
    <div class="text-right">
      <button class="btn btn-link code-block-copy-btn" data-clipboard-target="#id-6">Copy</button>
    </div>

    <pre><code id="id-6" class="language-html hljs xml"><span class=
"hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class=
"hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class=
"hljs-name">title</span>&gt;</span>headzoo.io<span class="hljs-tag">&lt;/<span class=
"hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class=
"hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class=
"hljs-attr">content</span>=<span class=
"hljs-string">"width=device-width, initial-scale=1"</span> <span class=
"hljs-attr">name</span>=<span class="hljs-string">"viewport"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class=
"hljs-attr">href</span>=<span class=
"hljs-string">"/build/css/app.0cbc3ec83fb34ac256fba3b70cb78067.css"</span> <span class=
"hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class=
"hljs-attr">media</span>=<span class="hljs-string">"screen"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class=
"hljs-attr">id</span>=<span class="hljs-string">"mount"</span>&gt;</span><span class=
"hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class=
"hljs-attr">src</span>=<span class=
"hljs-string">"/build/js/app.bb3cb705fc87f2a5570e.js"</span>&gt;</span><span class=
"undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
  </div>

  <p>Versioning needs to be enabled in <em>app/config/config.yml</em>.</p>

  <div class="code-block-container">
    <div class="text-right">
      <button class="btn btn-link code-block-copy-btn" data-clipboard-target="#id-7">Copy</button>
    </div>

    <pre><code id="id-7" class="language-yaml hljs"><span class="hljs-attr">framework:</span>
<span class="hljs-attr">  assets:</span>
<span class="hljs-attr">json_manifest_path:</span> <span class=
"hljs-string">"%kernel.project_dir%/web/build/manifest.json"</span></code></pre>
  </div>

  <p><strong>Running</strong>
  </p>

  <p>During development I run the following command in the PhpStorm terminal to have Webpack Encore
    to rebuild the js & scss files as they change.</p>

  <div class="code-block-container">
    <div class="text-right">
      <button class="btn btn-link code-block-copy-btn" data-clipboard-target="#id-8">Copy</button>
    </div>

    <pre><code id="id-8" class="language-bash hljs">node_modules/.bin/encore dev --watch</code></pre>
  </div>

  <p>To save myself a bit of typing I saved the command in a bash script as <em>bin/encore</em>.</p>

  <div class="code-block-container">
    <div class="text-right">
      <button class="btn btn-link code-block-copy-btn" data-clipboard-target="#id-9">Copy</button>
    </div>

    <pre><code id="id-9" class="language-bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
./node_modules/.bin/encore <span class="hljs-variable">$@</span></code></pre>
  </div>

  <p>Which I ran using this command.</p>

  <div class="code-block-container">
    <div class="text-right">
      <button class="btn btn-link code-block-copy-btn" data-clipboard-target="#id-10">Copy</button>
    </div>

    <pre><code id="id-10" class="language-bash hljs">bin/encore dev --watch</code></pre>
  </div>

  <p><strong>Conclusion</strong>
  </p>

  <p>I give Webpack Encore a solid B+. I found the method calls easier to work with because PhpStorm
    was able to provide type hints for each possible setting. When using Webpack's own configuration
    script, I find myself constantly checking the Webpack documentation. Which is a pain.</p>
</div>
